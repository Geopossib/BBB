/**
 * @fileoverview Firestore Security Rules for Prototyping.
 *
 * Core Philosophy:
 * This ruleset prioritizes rapid prototyping by focusing on authorization while relaxing data validation.
 * It enforces admin-only write access to all collections, allowing any authenticated user to read.
 *
 * Data Structure:
 * The database consists of four top-level collections: 'articles', 'videos', 'audios', and 'liveMeetings'.
 *
 * Key Security Decisions:
 * - Read access is public for authenticated users.
 * - Write access is restricted to admins only.
 * - No data shape validation is enforced during writes for prototyping speed.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Grants read access to all authenticated users and restricts write access to admins only for articles collection.
     * @path /databases/{database}/documents/articles/{articleId}
     * @allow (get, list) - Any authenticated user can read article data.
     * @allow (create, update, delete) - Only admins can create, update, or delete articles.
     * @deny (create, update, delete) - Non-admin users cannot modify article data.
     * @principle Restricts writes to admins only, allows public reads.
     */
    match /articles/{articleId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isAdmin();
    }

    /**
     * @description Grants read access to all authenticated users and restricts write access to admins only for videos collection.
     * @path /databases/{database}/documents/videos/{videoId}
     * @allow (get, list) - Any authenticated user can read video data.
     * @allow (create, update, delete) - Only admins can create, update, or delete videos.
     * @deny (create, update, delete) - Non-admin users cannot modify video data.
     * @principle Restricts writes to admins only, allows public reads.
     */
    match /videos/{videoId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isAdmin();
    }

    /**
     * @description Grants read access to all authenticated users and restricts write access to admins only for audios collection.
     * @path /databases/{database}/documents/audios/{audioId}
     * @allow (get, list) - Any authenticated user can read audio data.
     * @allow (create, update, delete) - Only admins can create, update, or delete audios.
     * @deny (create, update, delete) - Non-admin users cannot modify audio data.
     * @principle Restricts writes to admins only, allows public reads.
     */
    match /audios/{audioId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isAdmin();
    }

    /**
     * @description Grants read access to all authenticated users and restricts write access to admins only for liveMeetings collection.
     * @path /databases/{database}/documents/liveMeetings/{liveMeetingId}
     * @allow (get, list) - Any authenticated user can read liveMeeting data.
     * @allow (create, update, delete) - Only admins can create, update, or delete liveMeetings.
     * @deny (create, update, delete) - Non-admin users cannot modify liveMeeting data.
     * @principle Restricts writes to admins only, allows public reads.
     */
    match /liveMeetings/{liveMeetingId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isAdmin();
    }

    // ---- Helper functions ----

    /**
     * @description Checks if the user is signed in.
     * @return True if the user is authenticated, false otherwise.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Checks if the user is an admin.
     * @return True if the user has admin privileges, false otherwise.
     */
    function isAdmin() {
      // TODO: Implement admin role check using custom claims or a dedicated admin collection.
      return request.auth.uid == 'admin-user-id'; // Replace 'admin-user-id' with the actual admin user ID
    }
  }
}